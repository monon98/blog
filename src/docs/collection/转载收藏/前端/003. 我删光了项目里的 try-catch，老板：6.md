---
created: 2025-10-30T10:15:34 (UTC +08:00)
tags: [å‰ç«¯,Vue.jsä¸­æ–‡æŠ€æœ¯ç¤¾åŒº,å‰ç«¯å¼€å‘ç¤¾åŒº,å‰ç«¯æŠ€æœ¯äº¤æµ,å‰ç«¯æ¡†æ¶æ•™ç¨‹,JavaScript å­¦ä¹ èµ„æº,CSS æŠ€å·§ä¸æœ€ä½³å®è·µ,HTML5 æœ€æ–°åŠ¨æ€,å‰ç«¯å·¥ç¨‹å¸ˆèŒä¸šå‘å±•,å¼€æºå‰ç«¯é¡¹ç›®,å‰ç«¯æŠ€æœ¯è¶‹åŠ¿]
source: https://juejin.cn/post/7565811094734389248
author: å‰ç«¯ä¹å“¥
---

# æˆ‘åˆ å…‰äº†é¡¹ç›®é‡Œçš„ try-catchï¼Œè€æ¿ï¼š6

---
ç›¸ä¿¡æˆ‘ä»¬ç»å¸¸è¿™æ ·å†™bugï¼ˆä¸æ˜¯ ğŸ‘‡ï¼š  

```javascript
try {
  const res = await api.getUser()
  console.log('âœ… ç”¨æˆ·ä¿¡æ¯', res)
} catch (err) {
  console.error('âŒ è¯·æ±‚å¤±è´¥', err)
}
```

çœ‹ä¼¼æ²¡é—®é¢˜

-   æ¯ä¸ªæ¥å£éƒ½è¦ try-catchï¼Œå¤ªå•°å—¦äº†ï¼
-   é”™è¯¯å¤„ç†é€»è¾‘åˆ†æ•£ï¼Œä¸å¯æ§ï¼
-   ä»£ç åˆè‡­åˆé•¿ğŸ’¨ï¼


## ğŸ’¡ ç›®æ ‡ï¼š**ä¸æŠ›å¼‚å¸¸çš„å®‰å…¨è¯·æ±‚å°è£…**

æˆ‘ä»¬å¸Œæœ›å®ç°è¿™æ ·çš„è°ƒç”¨ğŸ‘‡ï¼š

```kotlin
const [err, data] = await safeRequest(api.getUser(1))
if (err) return showError(err)
console.log('âœ… ç”¨æˆ·ä¿¡æ¯ï¼š', data)
```

æ˜¯ä¸æ˜¯æ¸…çˆ½å¤šäº†ï¼Ÿâœ¨  
æ²¡æœ‰ try-catchï¼Œå´èƒ½åŒæ—¶æ‹¿åˆ°é”™è¯¯å’Œæ•°æ®ã€‚

## ğŸ§© å®ç°æ­¥éª¤

### 1ï¸âƒ£ å…ˆå°è£… Axios å®ä¾‹

```javascript
// src/utils/request.js
import axios from 'axios'
import { ElMessage } from 'element-plus'

const service = axios.create({
  baseURL: import.meta.env.VITE_API_BASE_URL,
  timeout: 10000,
})

// ğŸ§± è¯·æ±‚æ‹¦æˆªå™¨
service.interceptors.request.use(
  (config) => {
    const token = localStorage.getItem('token')
    if (token) config.headers.Authorization = `Bearer ${token}`
    return config
  },
  (error) => Promise.reject(error)
)

// ğŸ§± å“åº”æ‹¦æˆªå™¨
service.interceptors.response.use(
  (response) => {
    const res = response.data
    if (res.code !== 0) {
      ElMessage.error(res.message || 'è¯·æ±‚å¤±è´¥')
      return Promise.reject(new Error(res.message || 'è¯·æ±‚å¤±è´¥'))
    }
    return res.data
  },
  (error) => {
    ElMessage.error(error.message || 'ç½‘ç»œé”™è¯¯')
    return Promise.reject(error)
  }
)

export default service
```

æ‹¦æˆªå™¨çš„ä½œç”¨ï¼š

-   âœ… ç»Ÿä¸€å¤„ç† tokenï¼›
-   âœ… ç»Ÿä¸€å¤„ç†é”™è¯¯æç¤ºï¼›
-   âœ… ä¿è¯ä¸šåŠ¡å±‚æ‹¿åˆ°çš„æ°¸è¿œæ˜¯â€œå¹²å‡€çš„æ•°æ®â€ã€‚

___

### 2ï¸âƒ£ å°è£…ä¸€ä¸ªã€Œå®‰å…¨è¯·æ±‚å‡½æ•°ã€

```javascript
// src/utils/safeRequest.js
export async function safeRequest(promise) {
  try {
    const data = await promise
    return [null, data] // âœ… æˆåŠŸæ—¶è¿”å› [null, data]
  } catch (err) {
    return [err, null] // âŒ å¤±è´¥æ—¶è¿”å› [err, null]
  }
}
```

è¿™å°±æ˜¯å…³é”®ï¼  
å®ƒè®©æ‰€æœ‰ Promise éƒ½å˜å¾—ã€Œæ¸©æŸ”ã€â€”â€”ä¸å†æŠ›å‡ºå¼‚å¸¸ï¼Œè€Œæ˜¯è¿”å›ç»“æ„åŒ–ç»“æœã€‚

___

### 3ï¸âƒ£ å°è£… API æ¨¡å—

```javascript
// src/api/user.js
import request from '@/utils/request'

export const userApi = {
  getUser(id) {
    return request.get(`/user/${id}`)
  },
  updateUser(data) {
    return request.put('/user', data)
  },
}
```

___

### 4ï¸âƒ£ åœ¨ä¸šåŠ¡å±‚ä¼˜é›…è°ƒç”¨

```vue
<script setup>
import { ref, onMounted } from 'vue'
import { userApi } from '@/api/user'
import { safeRequest } from '@/utils/safeRequest'

const user = ref(null)

onMounted(async () => {
  const [err, data] = await safeRequest(userApi.getUser(1))
  if (err) return showError(err)
  console.log('âœ… ç”¨æˆ·ä¿¡æ¯ï¼š', data)
})
</script>
```

æ˜¯ä¸æ˜¯å¾ˆä¼˜é›…ã€æ•°æ®é€»è¾‘æ¸…æ™°ã€ä¸éœ€è¦ try-catchã€ é”™è¯¯ä¸å´©æºƒã€‚

**è€æ¿è¯´ï¼šç‰›ğŸºï¼Œä½ å°å­æœ‰ç‚¹ä¸œè¥¿**

## ğŸ§± æˆ‘ä»¬è¿˜å¯ä»¥è¿›ä¸€æ­¥ä¼˜åŒ–ï¼šå®ç°è‡ªåŠ¨é”™è¯¯æç¤º

æˆ‘ä»¬å¯ä»¥ç»™ `safeRequest` å¢åŠ ä¸€ä¸ªé€‰é¡¹ï¼Œè®©é”™è¯¯è‡ªåŠ¨æç¤ºï¼š

```javascript
// src/utils/safeRequest.js
import { ElMessage } from 'element-plus'

export async function safeRequest(promise, { showError = true } = {}) {
  try {
    const data = await promise
    return [null, data]
  } catch (err) {
    if (showError) {
      ElMessage.error(err.message || 'è¯·æ±‚å¤±è´¥')
    }
    return [err, null]
  }
}
```

ä½¿ç”¨æ—¶ğŸ‘‡ï¼š

```csharp
const [err, data] = await safeRequest(userApi.getUser(1), { showError: false })
```

è¿™æ ·ä½ å¯ä»¥çµæ´»æ§åˆ¶æ˜¯å¦å¼¹å‡ºé”™è¯¯æç¤ºï¼Œ  
æ¯”å¦‚æŸäº›é™é»˜è¯·æ±‚å°±å¯ä»¥å…³é—­æç¤ºã€‚

## ğŸ§  è¿›é˜¶ï¼šTypeScript æ”¯æŒï¼ˆè¶…ä¸æ»‘ï¼‰

å¦‚æœä½ ç”¨çš„æ˜¯ TypeScriptï¼Œå¯ä»¥è®©è¿”å›ç±»å‹æ›´æ™ºèƒ½ğŸ‘‡ï¼š

```javascript
export async function safeRequest<T>(
  promise: Promise<T>
): Promise<[Error | null, T | null]> {
  try {
    const data = await promise
    return [null, data]
  } catch (err) {
    return [err as Error, null]
  }
}
```

è°ƒç”¨æ—¶ï¼š

```javascript
const [err, user] = await safeRequest<User>(userApi.getUser(1))
if (user) console.log(user.name) // âœ… è‡ªåŠ¨æç¤ºç±»å‹
```

è€æ¿ï¼šå†™å¾—å¾ˆå¥½ï¼Œä¸‹æ¬¡å¤šå†™ç‚¹ï¼Œæ˜å¤©ä½ æ¥å½“è€æ¿
